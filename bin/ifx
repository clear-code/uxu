#!/usr/bin/env ruby

require 'readline'
require 'socket'

port = ARGV.shift || 4444

TCPSocket.open("localhost", port) do |socket|
  while line = Readline.readline("firefox> ", true)
    begin
      socket.puts(line)
    rescue Errno::EPIPE
      break
    end
    buf = ""
    while IO.select([socket], [], [], 0.05)
      break if socket.eof?
      socket.readpartial(4096, buf)
    end
    puts buf unless buf.empty?
  end
end
